<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Administração de Fretes</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2rem; }
    table { border-collapse: collapse; width: 100%; margin-top: 1rem; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #f0f0f0; }
    input, button { padding: 8px; margin: 5px; }
  </style>
</head>
<body>

  <h1>Cadastro de Fretes</h1>

  <form id="formCadastro">
    <input type="text" name="id" placeholder="ID" required>
    <input type="text" name="origem" placeholder="Origem" required>
    <input type="text" name="destino" placeholder="Destino" required>
    <button type="submit">Cadastrar</button>
  </form>

  <div id="mensagem"></div>

  <h2>Lista de Cargas</h2>
  <table id="tabelaCargas">
    <thead></thead>
    <tbody></tbody>
  </table>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbwyC2CHl4xjoEMJ12zrM2GSiTN8FEDe_Jl5aglbpZ9x-VcBNNxx-N8zBcfl7iNHJjrbgg/exec"; // substitua pela sua URL de implantação

    async function carregarCargas() {
      const tabela = document.getElementById("tabelaCargas");
      const thead = tabela.querySelector("thead");
      const tbody = tabela.querySelector("tbody");

      thead.innerHTML = "";
      tbody.innerHTML = "";

      try {
        const res = await fetch(API_URL);
        const dados = JSON.parse(await res.text());

        if (!dados.length) {
          tbody.innerHTML = "<tr><td colspan='4'>Nenhuma carga cadastrada.</td></tr>";
          return;
        }

        // Cabeçalhos
        const colunas = Object.keys(dados[0]);
        thead.innerHTML = "<tr>" + colunas.map(c => `<th>${c}</th>`).join("") + "<th>Ações</th></tr>";

        // Linhas
        dados.forEach(carga => {
          const linha = colunas.map(c => `<td>${carga[c] || ""}</td>`).join("");
          const botao = `<td><button onclick="removerCarga('${carga.id}')">Remover</button></td>`;
          tbody.innerHTML += `<tr>${linha}${botao}</tr>`;
        });

      } catch (err) {
        console.error(err);
        tbody.innerHTML = "<tr><td colspan='4'>❌ Erro ao carregar dados</td></tr>";
      }
    }

    async function removerCarga(id) {
      if (!confirm("Deseja realmente remover esta carga?")) return;

      try {
        const res = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: new URLSearchParams({ action: "delete", id })
        });

        const json = JSON.parse(await res.text());
        alert(json.message);
        carregarCargas();

      } catch (err) {
        console.error(err);
        alert("❌ Erro ao remover carga.");
      }
    }

    document.getElementById("formCadastro").addEventListener("submit", async e => {
      e.preventDefault();
      const form = e.target;
      const dados = new URLSearchParams(new FormData(form));

      try {
        const res = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: dados
        });

        const json = JSON.parse(await res.text());
        document.getElementById("mensagem").innerText = json.message;
        form.reset();
        carregarCargas();

      } catch (err) {
        console.error(err);
        alert("❌ Erro ao cadastrar carga.");
      }
    });

    // Inicial
    carregarCargas();
  </script>

</body>
</html>
